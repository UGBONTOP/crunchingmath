<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stealth Shadow Player</title>
    <style>
        body { background: #111; color: #eee; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #vault { width: 560px; height: 315px; background: #000; border: 1px solid #333; }
        input { padding: 10px; width: 300px; border-radius: 4px; border: none; }
        button { padding: 10px 20px; cursor: pointer; background: #222; color: #fff; border: 1px solid #444; border-radius: 4px; }
        .ui { margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="ui">
        <input type="text" id="urlInput" placeholder="Enter YouTube Link">
        <button onclick="deployStealth()">Launch</button>
    </div>

    <div id="vault"></div>

    <script>
        function deployStealth() {
            const url = document.getElementById('urlInput').value;
            const videoId = extractId(url);
            if (!videoId) return alert("Invalid ID");

            const vault = document.getElementById('vault');
            vault.innerHTML = ""; // Clear previous

            // 1. Create a "Closed" Shadow Root
            // 'closed' makes it inaccessible to main-page JavaScript (and many extensions)
            const shadow = vault.attachShadow({mode: 'closed'});

            // 2. Build the iframe element in memory (not in the DOM yet)
            const ifr = document.createElement('iframe');
            
            // Set attributes one by one to avoid string detection
            ifr.setAttribute('width', '100%');
            ifr.setAttribute('height', '100%');
            ifr.setAttribute('frameborder', '0');
            
            // Fix for Error 153 (Permissions)
            ifr.setAttribute('allow', 'fullscreen; autoplay; encrypted-media');
            ifr.setAttribute('allowfullscreen', '');

            // 3. De-obfuscate the URL at the last possible millisecond
            // We use a small delay to separate the 'creation' from the 'loading'
            setTimeout(() => {
                const parts = ['https://', 'www.', 'youtube.com/', 'embed/', videoId];
                ifr.src = parts.join('');
            }, 50);

            // 4. Inject into the Shadow DOM
            shadow.appendChild(ifr);
        }

        function extractId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
    </script>
</body>
</html>